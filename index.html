<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>121 → 180 Darts Practice</title>
<style>
body { font-family: system-ui, sans-serif; text-align:center; padding:20px; background:#f7f7f7; }
.big { font-size:2.2rem; margin:12px 0; }
.small { font-size:1.2rem; color:#555; }
input, button { font-size:1.6rem; padding:12px; margin:8px 0; width:90%; max-width:320px; }
button { background:#222; color:white; border:none; border-radius:6px; }
button:active { background:#444; }
/* added: small top-left button style */
.top-left { position: absolute; top: 12px; left: 12px; padding:8px 10px; font-size:1rem; width:auto; max-width:none; }
/* added: quick numeric button styles */
#quickNums { margin-top: 6px; }
.num-btn { width:64px; margin:6px 6px; padding:8px; font-size:1.2rem; border-radius:6px; background:#444; color:#fff; border:none; }
.num-btn:active { background:#666; }
/* added: preset visit buttons */
.preset-row { margin-top:10px; display:flex; flex-wrap:wrap; gap:8px; justify-content:center; }
/* make preset buttons narrow despite the global button width:90% rule */
.preset-btn { width:auto; min-width:64px; padding:6px 10px; border-radius:6px; background:#0b6; color:#042; font-weight:600; border:none; font-size:1rem; }
.preset-btn:active { filter:brightness(.9); }
/* added: controls layout and bust/undo button colors */
.controls { display:flex; gap:10px; justify-content:center; align-items:center; }
.controls button { width:auto; min-width:120px; max-width:none; padding:10px 14px; }
.bust-btn { background:#c62828; color:white; }
.bust-btn:active { background:#e53935; }
.undo-btn { background:#6b6b6b; }
.undo-btn:active { background:#8a8a8a; }
</style>
</head>
<body>

<!-- added: Set start button in the top-left -->
<button class="top-left" onclick="setStartingNumber()">Set start</button>

<div class="big">Target: <span id="target">121</span></div>
<div class="big">Score: <span id="score">0</span></div>
<div class="small">Remaining this attempt:</div>
<div class="big"><span id="remaining">121</span></div>
<div class="small">Visits at this target: <span id="visits">0</span></div>
<div class="small">Consecutive 9-dart misses: <span id="consecMisses">0</span></div>

<input id="visit" type="number" inputmode="numeric" placeholder="Enter 3-dart total"/>
<!-- changed: submit, bust and undo side-by-side -->
<div class="controls">
  <button onclick="submitVisit()">Submit visit</button>
  <button class="bust-btn" onclick="bustVisit()">Bust</button>
  <button class="undo-btn" onclick="undo()">Undo</button>
</div>

<!-- added: quick numeric buttons 1, 2, 3 -->
<div id="quickNums">
  <button class="num-btn" onclick="submitVisit(1)">1</button>
  <button class="num-btn" onclick="submitVisit(2)">2</button>
  <button class="num-btn" onclick="submitVisit(3)">3</button>
</div>

<!-- added: preset visit buttons that auto-fill and submit -->
<div class="preset-row">
  <button class="preset-btn" onclick="autoSubmitVisit(26)">26</button>
  <button class="preset-btn" onclick="autoSubmitVisit(29)">29</button>
  <button class="preset-btn" onclick="autoSubmitVisit(41)">41</button>
  <button class="preset-btn" onclick="autoSubmitVisit(45)">45</button>
  <button class="preset-btn" onclick="autoSubmitVisit(57)">57</button>
  <button class="preset-btn" onclick="autoSubmitVisit(60)">60</button>
  <button class="preset-btn" onclick="autoSubmitVisit(95)">95</button>
  <button class="preset-btn" onclick="autoSubmitVisit(100)">100</button>
  <button class="preset-btn" onclick="autoSubmitVisit(140)">140</button>
  <button class="preset-btn" onclick="autoSubmitVisit(180)">180</button>
</div>

<div class="big" id="status"></div>

<script>
let game = {
  target: 121,
  score: 0,
  currentRemaining: 121,
  visitsAtTarget: 0,
  consecutive9Misses: 0
};

const remainingEl = document.getElementById("remaining");
const targetEl = document.getElementById("target");
const scoreEl = document.getElementById("score");
const statusEl = document.getElementById("status");
const visitsEl = document.getElementById("visits");
const consecMissesEl = document.getElementById("consecMisses");
const visitInput = document.getElementById("visit");

// added: handler to prompt for a starting number and reset game state
function setStartingNumber() {
  let val = prompt("Enter starting target:", String(game.target));
  if (val === null) return; // cancelled
  val = Number(val);
  if (!Number.isFinite(val) || val <= 0) {
    alert("Please enter a positive number");
    return;
  }
  pushState();
  game.target = Math.floor(val);
  game.currentRemaining = game.target;
  game.score = 0;
  game.visitsAtTarget = 0;
  game.consecutive9Misses = 0;
  updateUI(`Starting target set to ${game.target}`);
}

function submitVisit(quickSetValue = null) {
  let dartsUsed;
  let increment;
  if (quickSetValue !== null) {
    pushState();
    dartsUsed = (3 * game.visitsAtTarget) + quickSetValue;
    increment = 10 - dartsUsed;
    game.score += increment;
    game.target += increment;
    game.currentRemaining = game.target;

    // Reset counters
    game.visitsAtTarget = 0;
    game.consecutive9Misses = 0;

    updateUI(`HIT! Score +${increment}, target now ${game.target}`);
    return;
  }
  let visit = Number(visitInput.value);
  visitInput.value = "";
  if (!Number.isFinite(visit) || visit < 0) return;

  pushState();
  game.visitsAtTarget++;

  // Exact hit
  if (visit === game.currentRemaining) {
    dartsUsed = prompt("You hit the target! How many darts did it take? (1–9)", "3");
    dartsUsed = Number(dartsUsed);
    if (!Number.isFinite(dartsUsed) || dartsUsed < 1) dartsUsed = 1;
    if (dartsUsed > 9) dartsUsed = 9;

    increment = 10 - dartsUsed;
    game.score += increment;
    game.target += increment;
    game.currentRemaining = game.target;

    // Reset counters
    game.visitsAtTarget = 0;
    game.consecutive9Misses = 0;

    updateUI(`HIT! Score +${increment}, target now ${game.target}`);
    return;
  }

  if (visit > game.currentRemaining) {
    // Bust (over-hit)
    game.currentRemaining -= 0; // Remain unchanged as per original rules
    updateUI(`Bust! Missed the target, remaining reset to target`);
  } else {
    // Normal miss (under-hit)
    game.currentRemaining -= visit;
    updateUI(`Next visit, remaining: ${game.currentRemaining}`);
  }

  

  // After 3 visits (1 9-dart attempt) without hitting target
  if (game.visitsAtTarget >= 3) {
    game.consecutive9Misses++;
    game.visitsAtTarget = 0;
    game.currentRemaining = game.target;
    updateUI(`9-dart attempt missed, remaining reset to target ${game.target}`);

    // Trigger penalty prompt only after 3 consecutive 9-dart misses
    if (game.consecutive9Misses >= 3) {
      const takeShot = confirm("3 consecutive 9-dart attempts missed! Take shot?\nOK = take shot\nCancel = decrease 1");
      if (!takeShot) {
        game.target--;
        game.currentRemaining = game.target;
        updateUI(`Target decreased by 1! New target: ${game.target}`);
      }
    }
  }
}

// added: handler for explicit Bust button (counts as a visit and applies 3-visit logic)
function bustVisit() {
  pushState();
  game.visitsAtTarget++;
  game.currentRemaining -= 0; // Remain unchanged as per original rules
  updateUI(`Bust! Missed the target, remaining reset to target`);

  if (game.visitsAtTarget >= 3) {
    game.consecutive9Misses++;
    game.visitsAtTarget = 0;
    game.currentRemaining = game.target;
    updateUI(`9-dart attempt missed, remaining reset to target ${game.target}`);

    if (game.consecutive9Misses >= 3) {
      const takeShot = confirm("3 consecutive 9-dart attempts missed! Take shot?\nOK = take shot\nCancel = decrease 1");
      if (!takeShot) {
        game.target--;
        game.currentRemaining = game.target;
        updateUI(`Target decreased by 1! New target: ${game.target}`);
      }
    }
  }
}

let history = [];
function pushState() {
  // store a deep copy of the game state
  history.push(JSON.parse(JSON.stringify(game)));
  // optional cap
  if (history.length > 50) history.shift();
}

function undo() {
  if (history.length === 0) {
    updateUI('Nothing to undo');
    return;
  }
  const prev = history.pop();
  // replace game object properties
  game = prev;
  updateUI('Undid last action');
}

function updateUI(status="") {
  targetEl.textContent = game.target;
  scoreEl.textContent = game.score;
  remainingEl.textContent = game.currentRemaining;
  visitsEl.textContent = game.visitsAtTarget;
  consecMissesEl.textContent = game.consecutive9Misses;
  statusEl.textContent = status;
}

// helper to auto-fill the visit input and submit
function autoSubmitVisit(value) {
  visitInput.value = String(value);
  submitVisit();
}

// Initial render
updateUI();
</script>

</body>
</html>

